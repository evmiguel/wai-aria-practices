const prettier = require("prettier");

const formatForJekyll = ({
  title,
  sitePath,
  addBodyClass,
  content,
  enableSidebar = false,
  enableSidenav = false,
  githubPath,
  head = "",
  footer = null,
  paths = [],
  navTitle = ''
}) => {
  const permalink = `/ARIA/apg/${sitePath}`;

  // Must be formatted because html which is indented by 4 spaces
  // will be interpreted as a code block by the markdown engine
  const formattedHead = prettier.format(head, { parser: "html" });

  return `---
# This file was generated by scripts/pre-build/library/formatForJekyll.js
title: "${title}"
ref: ${permalink}

github:
  repository: w3c/aria-practices
  branch: main
  path: ${githubPath}
feedbackmail: public-aria-practices@w3.org
permalink: ${permalink}

sidebar: ${enableSidebar}
sidenav: ${enableSidenav}

${!footer ? "" : `footer: "${footer.replace(/\n/g, "").replace(/"/g, "'")}"`}

# Context here: https://github.com/w3c/wai-aria-practices/issues/31
type_of_guidance: APG

lang: en
---
${formattedHead}
${/* ${prettier.format(` */ ""}
<link 
  rel="stylesheet"
  href="{{ '/content-assets/wai-aria-practices/styles.css' | relative_url }}"
>
<!-- Code highlighting styles -->
<link 
  rel="stylesheet"
  href="{{ '/content-assets/wai-aria-practices/shared/css/github.css' | relative_url }}"
>
${
  !(addBodyClass || enableSidebar)
    ? ""
    : `
<script>
const addBodyClass = ${JSON.stringify(addBodyClass)};
const enableSidebar = ${JSON.stringify(enableSidebar)};
if (addBodyClass) document.body.classList.add(addBodyClass);
if (enableSidebar) document.body.classList.add('has-sidebar');
</script>
    `
}

${
  // Make nav items active when on children pages
  `<script>
    const parentPage = window.location.pathname.match(
      /\\/(patterns|practices)\\//
    )?.[1];
    if (parentPage) {
      const parentHref = 'a[href*="' + parentPage + '"]';
      document.querySelector(parentHref).classList.add('active');
    }
  </script>`
}
<div>
${content}
</div>
<script id="rawData">
    const rawData = ${JSON.stringify({paths})};
    const sideNavTitle = "${navTitle}";
</script>
<script 
  src="{{ '/content-assets/wai-aria-practices/shared/js/skipto.js' | relative_url }}"
></script>
<script 
  src="{{ '/content-assets/wai-aria-practices/shared/js/sidenav.js' | relative_url }}"
></script>
${/* `, { parser: "html" })} */ ""}`;
};

module.exports = formatForJekyll;
